<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>title</title>
  </head>
  <body>
    <script type="module">
      import * as Distro from "./dist/distro.js";

      let params = new URLSearchParams(window.location.search);

      if (params.has("connect")) {
        window.os = await Distro.connect("broadcastchannel://os-demo");
      } else {
        window.os = await Distro.boot();
        os.getAPI("me.endercass.server").serve("broadcastchannel://os-demo");
      }

      function createIncrDecrSample(name) {
        let wrapper = document.createElement("div");
        let incrButton = document.createElement("button");
        incrButton.textContent = `Increment ${name}`;
        let decrButton = document.createElement("button");
        decrButton.textContent = `Decrement ${name}`;
        let valueSpan = document.createElement("span");
        valueSpan.textContent = "0";
        wrapper.appendChild(incrButton);
        wrapper.appendChild(decrButton);
        wrapper.appendChild(valueSpan);
        document.body.appendChild(wrapper);

        os.registry.watch(name, (value) => {
          valueSpan.textContent = value;
        });
        incrButton.onclick = async () => {
          let value = (await os.registry.read(name)) || 0;
          await os.registry.write(name, value + 1);
        };
        decrButton.onclick = async () => {
          let value = (await os.registry.read(name)) || 0;
          await os.registry.write(name, value - 1);
        };
      }

      createIncrDecrSample("abc.counter1");
      createIncrDecrSample("abc.counter2");
    </script>
  </body>
</html>
